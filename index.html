<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kara C. Hoover">

<title>Time Series Models Forecast a Shift in Global R&amp;D Leadership Away from the West</title>
<style>
/* Default styles provided by pandoc.
** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
*/
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="forecasting-rd-leadership-dynamics_files/libs/clipboard/clipboard.min.js"></script>
<script src="forecasting-rd-leadership-dynamics_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="forecasting-rd-leadership-dynamics_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="forecasting-rd-leadership-dynamics_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="forecasting-rd-leadership-dynamics_files/libs/quarto-html/popper.min.js"></script>
<script src="forecasting-rd-leadership-dynamics_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="forecasting-rd-leadership-dynamics_files/libs/quarto-html/anchor.min.js"></script>
<link href="forecasting-rd-leadership-dynamics_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="forecasting-rd-leadership-dynamics_files/libs/quarto-html/quarto-syntax-highlighting-076ecbd647e1f0418c5051713cd9b730.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="forecasting-rd-leadership-dynamics_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="forecasting-rd-leadership-dynamics_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="forecasting-rd-leadership-dynamics_files/libs/bootstrap/bootstrap-fdc35ccebf6ef883c9ad23e25989f106.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="blues quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#research-question" id="toc-research-question" class="nav-link" data-scroll-target="#research-question">Research Question</a></li>
  <li><a href="#research-answers" id="toc-research-answers" class="nav-link" data-scroll-target="#research-answers">Research Answers</a>
  <ul class="collapse">
  <li><a href="#aging-is-universal-but-asymmetric" id="toc-aging-is-universal-but-asymmetric" class="nav-link" data-scroll-target="#aging-is-universal-but-asymmetric">Aging is Universal but Asymmetric</a></li>
  <li><a href="#rd-expenditure-growth-slows-as-populations-age" id="toc-rd-expenditure-growth-slows-as-populations-age" class="nav-link" data-scroll-target="#rd-expenditure-growth-slows-as-populations-age">R&amp;D Expenditure Growth Slows as Populations Age</a></li>
  <li><a href="#the-west-has-plateaued-emerging-regions-continue-to-grow" id="toc-the-west-has-plateaued-emerging-regions-continue-to-grow" class="nav-link" data-scroll-target="#the-west-has-plateaued-emerging-regions-continue-to-grow">The West Has Plateaued; Emerging Regions Continue to Grow</a></li>
  <li><a href="#researcher-numbers-are-most-unstable-in-asia" id="toc-researcher-numbers-are-most-unstable-in-asia" class="nav-link" data-scroll-target="#researcher-numbers-are-most-unstable-in-asia">Researcher Numbers Are Most Unstable in Asia</a></li>
  </ul></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next Steps</a></li>
  <li><a href="#study-design" id="toc-study-design" class="nav-link" data-scroll-target="#study-design">Study Design</a></li>
  <li><a href="#project-resources" id="toc-project-resources" class="nav-link" data-scroll-target="#project-resources">Project Resources</a></li>
  <li><a href="#tools-technologies" id="toc-tools-technologies" class="nav-link" data-scroll-target="#tools-technologies">Tools &amp; Technologies</a></li>
  <li><a href="#expertise" id="toc-expertise" class="nav-link" data-scroll-target="#expertise">Expertise</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Time Series Models Forecast a Shift in Global R&amp;D Leadership Away from the West</h1>
  <div class="quarto-categories">
    <div class="quarto-category">time series</div>
    <div class="quarto-category">forecasting</div>
    <div class="quarto-category">policy</div>
    <div class="quarto-category">R&amp;D</div>
    <div class="quarto-category">data visualization</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kara C. Hoover </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="executive-summary" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary">Executive Summary</h2>
<p><strong>Problem:</strong> Countries with high GDP are aging rapidly – <a href="https://www.who.int/news-room/fact-sheets/detail/ageing-and-health">by 2050, the share of the global population over 60 will double from 12% to 22%</a>. R&amp;D leadership depends on a skilled, active research workforce. If high-GDP Western countries cannot replace retiring researchers, their dominance in global R&amp;D will erode. Emerging regions are also aging, but their populations remain younger relative to the West and their research infrastructures are growing. The question is whether this demographic asymmetry will translate into a shift in global R&amp;D leadership over the next two to three decades.</p>
<p><strong>Approach:</strong> V-Dem and World Bank data included old age dependency, R&amp;D expenditure, scientific publications, and researchers in R&amp;D across six world regions from 1996 to 2019. Time series analysis identified regional trends while linear regression models (with region interactions) generated predicted values for two R&amp;D productivity measures as a function of aging. Jenks natural breaks classification grouped countries by age dependency profile to examine how R&amp;D expenditure trajectories differ across young, middle-aged, and old populations.</p>
<p><strong>Insights:</strong> Time series forecasting models predict that R&amp;D leadership will shift from Western regions to emerging economies – particularly Asia, Latin America, and the Middle East – if current demographic and investment trajectories continue. The West has already plateaued in researcher growth despite maintaining the highest absolute output. Strategic partnerships with younger-population regions and proactive investment in research infrastructure are the most viable policy levers for sustaining Western R&amp;D relevance.</p>
<p><strong>Significance:</strong> This analysis provides an evidence base for international R&amp;D funding strategy. Identifying which regions have youthful workforces and growing research capacity – and pairing that with which high-GDP countries face workforce gaps – creates a actionable framework for bilateral and multilateral co-funding decisions.</p>
<p><strong>Key Findings</strong></p>
<ul>
<li>All regions are experiencing rising old age dependency; the West and Eastern Europe have the highest current ratios, averaging approximately 25 dependents per 100 working-age adults</li>
<li>R&amp;D expenditure growth is slower in countries with older populations – middle-aged countries grew at an average of 3.5%, while older countries like Italy and Japan grew at 2.1% and 2.8% respectively</li>
<li>Scientific publication output has plateaued in the West but continues to grow in Asia, Latin America, and the Middle East (but the latter has potential inflation due to unethical practices)</li>
<li>Predictive models show that as old age dependency rises, both publications per million and researchers per million decline – with the largest predicted declines in the West and Eastern Europe</li>
<li>Africa’s output remains severely below its human potential, with peak papers at only 4% of GDP; predictive models suggest continued limited growth</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Policy Recommendations
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Forge strategic R&amp;D partnerships with emerging economies that have younger workforces and growing research capacity – programs like <a href="https://www.nih.gov/news-events/news-releases/nih-awards-nearly-75m-catalyze-data-science-research-africa">NIH DS-I Africa</a> and <a href="https://trendinafrica.org/">TREND in Africa</a> offer a model for co-investment in regions with untapped human talent</li>
<li>Invest in workforce retention policies targeting older researchers and incentive structures to attract the smaller pool of younger workers, including <a href="https://www.cnbc.com/2022/06/15/new-report-finds-the-top-work-preferences-amongst-gen-z-talent-.html">workplace equity and professional growth pathways</a>, and streamlined international recruitment</li>
<li>Disaggregate regional R&amp;D analysis to the country level before making funding decisions – regional averages obscure large within-region variation, particularly in Asia and Africa</li>
</ul>
</div>
</div>
<hr>
</section>
<section id="research-question" class="level2">
<h2 class="anchored" data-anchor-id="research-question">Research Question</h2>
<p>How will aging populations in traditionally dominant R&amp;D regions affect global leadership in innovation and technology development?</p>
<hr>
</section>
<section id="research-answers" class="level2">
<h2 class="anchored" data-anchor-id="research-answers">Research Answers</h2>
<section id="aging-is-universal-but-asymmetric" class="level3">
<h3 class="anchored" data-anchor-id="aging-is-universal-but-asymmetric">Aging is Universal but Asymmetric</h3>
<p>All six regions show rising old age dependency from 1996 to 2019, but the rate and current level vary substantially. The West and Eastern Europe lead with the highest dependency ratios. Asia presents a particularly misleading regional average – <a href="https://chinapower.csis.org/china-demographics-challenges/">China’s population is shrinking and aging rapidly</a> while <a href="https://www.deccanherald.com/india/indias-population-estimated-at-144-crore-24-in-0-14-age-bracket-unfpa-report-2981883">India, which recently surpassed China in total population, has only 7% aged 65+</a>. Africa’s dependency ratio remains the lowest but is rising. Regional trends are a starting point; country-level analysis is essential for investment decisions.</p>
<p><strong>Figure 1. Trends in old age dependency by region, 1996–2019.</strong></p>
<p><img src="plotoldAgeDependency.jpeg" class="img-fluid"></p>
<p><strong>Interpretation:</strong> The West and Eastern Europe are already carrying the highest dependency loads and show the steepest upward trajectories. Asia’s regional average is misleading – China and India are on opposite demographic paths. Africa’s low but rising ratio signals a future transition that is not yet reflected in R&amp;D infrastructure.</p>
</section>
<section id="rd-expenditure-growth-slows-as-populations-age" class="level3">
<h3 class="anchored" data-anchor-id="rd-expenditure-growth-slows-as-populations-age">R&amp;D Expenditure Growth Slows as Populations Age</h3>
<p>Grouping countries by old age dependency using Jenks natural breaks reveals a clear pattern: middle-aged countries (moderate dependency ratios) show the highest R&amp;D expenditure growth at an average of 3.5% per three-year period. Countries with older populations – including Italy and Japan – show slower growth at 2.1% and 2.8% respectively. This is not simply a wealth effect: these are among the wealthiest countries in the dataset.</p>
<p><strong>Figure 2. Change in R&amp;D expenditure every three years by age dependency category, 1996–2019.</strong></p>
<iframe src="RdExpenditureChange.html" width="100%" height="600" style="border:none;">
</iframe>
<p><strong>Interpretation:</strong> The Jenks classification separates countries not by wealth but by demographic profile – and expenditure growth tracks dependency ratios more closely than GDP. Middle-aged countries are the most dynamic investors; older countries are slowing regardless of absolute wealth, which has direct implications for where R&amp;D partnerships will yield the highest return.</p>
</section>
<section id="the-west-has-plateaued-emerging-regions-continue-to-grow" class="level3">
<h3 class="anchored" data-anchor-id="the-west-has-plateaued-emerging-regions-continue-to-grow">The West Has Plateaued; Emerging Regions Continue to Grow</h3>
<p>Scientific publication output scaled to population tells a striking story. The West has the highest absolute output but has shown no growth for approximately seven years. Eastern Europe closely mirrors the West but experienced a publication downturn during the Kosovo War. Asia, Latin America, and the Middle East continue to grow, with the Middle East showing the steepest trajectory – though some of that growth reflects <a href="https://www.science.org/content/article/vendor-offering-citations-purchase-latest-bad-actor-scholarly-publishing">citation manipulation practices</a> documented in Saudi Arabia, which inflates rankings by paying academics to list Saudi institutions as affiliations – part of a broader pattern of <a href="https://www.science.org/doi/10.1126/science.334.6061.1344">research integrity concerns</a> including <a href="https://crsreports.congress.gov/product/pdf/IF/IF12589">malignant foreign talent recruitment</a> that have drawn attention from <a href="https://www.whitehouse.gov/ostp/news-updates/2022/08/31/an-update-on-research-securitystreamlining-disclosure-standards-to-enhance-clarity-transparency-and-equity/">US research security policy</a>.</p>
<p>Predictive regression models confirm the regional divergence. As old age dependency rises, publications per million decline – with the steepest predicted declines in the West and Eastern Europe, and continued growth projected for Asia, Latin America, and the Middle East. Africa and the Middle East show the widest prediction intervals, reflecting less consistent historical data.</p>
<p><strong>Figure 3. Predicted impact of aging population on scientific publications per million, by region.</strong></p>
<iframe src="PredPubs.html" width="100%" height="600" style="border:none;">
</iframe>
<p><strong>Interpretation:</strong> The predicted trajectories confirm what the time series suggests – the West is heading toward decline while Asia, Latin America, and the Middle East continue upward. The wide prediction intervals for Africa and the Middle East reflect data sparsity and volatility, not uncertainty about the direction.</p>
</section>
<section id="researcher-numbers-are-most-unstable-in-asia" class="level3">
<h3 class="anchored" data-anchor-id="researcher-numbers-are-most-unstable-in-asia">Researcher Numbers Are Most Unstable in Asia</h3>
<p>The number of researchers in R&amp;D shows greater volatility than publication counts, particularly in Asia. The West has the largest researcher base and steepest historical growth curve but has begun to flatten. Asia, Latin America, and the Middle East show exponential growth. Eastern Europe rebounded after political upheavals earlier in the study period, though the ongoing conflict in Ukraine poses a direct threat – Ukraine has already <a href="https://www.nature.com/articles/s41599-023-02346-x">lost 33.5% of its researchers</a>, and even if the conflict ended, permanent losses are estimated at 7%. The broader lesson: research infrastructure collapses faster than it builds, and workforce gaps compound across generations through lost mentorship capacity.</p>
<p><strong>Figure 4. Predicted impact of aging population on researchers in R&amp;D per million, by region.</strong></p>
<iframe src="PredRd.html" width="100%" height="600" style="border:none;">
</iframe>
<p><strong>Interpretation:</strong> Researcher counts are more volatile than publication counts – they respond faster to political disruption, funding cuts, and demographic shifts. The Ukraine example is a live case study: workforce losses compound through lost mentorship and institutional knowledge in ways that publication metrics lag by years.</p>
<hr>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps</h2>
<p>This analysis examines regional trends; country-level models are the essential next step. Within-region variation is substantial – Japan versus Cambodia, or Kenya versus the Democratic Republic of the Congo, represent entirely different starting points for investment potential. Identifying high-performing countries within young-population regions and pairing them with aging high-GDP countries facing workforce gaps is the practical output of this analysis framework.</p>
<p>Future iterations could incorporate clinical trials, patents, and grants data for a more complete picture of the research timeline. Advanced network analysis could track the evolution of international collaborations. Machine learning models could forecast which specific fields face the largest workforce shortfalls.</p>
<hr>
</section>
<section id="study-design" class="level2">
<h2 class="anchored" data-anchor-id="study-design">Study Design</h2>
<p><strong>Data:</strong> V-Dem dataset accessed via <code>vdemdata</code> R package for political geographic region classification. World Bank data accessed via <code>wbstats</code>: total population (SP.POP.TOTL), GDP (NY.GDP.MKTP.CD), old age dependency ratio (SP.POP.DPND.OL), R&amp;D expenditure as % of GDP (GB.XPD.RSDV.GD.ZS), researchers in R&amp;D per million (SP.POP.SCIE.RD.P6), and scientific journal articles (IP.JRN.ARTC.SC). Publication counts were transformed to per-million scale to match the researchers variable. Analysis period: 1996–2019 (excluding 2020 to avoid COVID-19 disruption). Merge performed on ISO3 country code and year.</p>
<p><strong>Analytical Approach:</strong></p>
<ol type="1">
<li>Downloaded and merged V-Dem and World Bank data on ISO3 country code and year</li>
<li>Summarized all variables by region and year using medians (1996–2019)</li>
<li>Produced static faceted line chart of old age dependency trends by region</li>
<li>Applied Jenks natural breaks to classify countries into three age dependency groups; computed three-year change in R&amp;D expenditure per group and visualized as interactive time series</li>
<li>Fit linear regression models with region interaction terms for two outcomes (publications per million, researchers per million) as a function of old age dependency; generated predicted values using <code>ggeffects::ggpredict()</code> and visualized as interactive faceted ribbon plots by region</li>
</ol>
<hr>
</section>
<section id="project-resources" class="level2">
<h2 class="anchored" data-anchor-id="project-resources">Project Resources</h2>
<p><strong>Repository:</strong> <a href="https://github.com/kchoover14/forecasting-rd-leadership-dynamics">github.com/kchoover14/forecasting-rd-leadership-dynamics</a></p>
<p><strong>Data:</strong> Two datasets merged for analysis – V-Dem accessed via the <code>vdemdata</code> R package (freely available); World Bank data accessed via <code>wbstats</code> (freely available). No data files included in repo – both sources are accessed directly via their R packages.</p>
<p><strong>Code:</strong></p>
<ul>
<li><code>forecasting-rd-leadership-dynamics.R</code> – full analysis script: data merge, time series, Jenks classification, regression models, interactive figures</li>
</ul>
<p><strong>Project Artifacts:</strong></p>
<ul>
<li>Figures (n=1 static, n=3 interactive HTML)</li>
</ul>
<p><strong>Environment:</strong></p>
<ul>
<li><code>renv.lock</code> and <code>renv/</code> – restore package environment with <code>renv::restore()</code></li>
</ul>
<p><strong>License:</strong></p>
<ul>
<li>Code and scripts © Kara C. Hoover, licensed under the <a href="LICENSE">MIT License</a>.</li>
<li>Data, figures, and written content © Kara C. Hoover, licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>.</li>
</ul>
<hr>
</section>
<section id="tools-technologies" class="level2">
<h2 class="anchored" data-anchor-id="tools-technologies">Tools &amp; Technologies</h2>
<p><strong>Languages:</strong> R</p>
<p><strong>Tools:</strong> RStudio | GitHub</p>
<p><strong>Packages:</strong> vdemdata | wbstats | countrycode | dplyr | tidyr | ggplot2 | plotly | ggeffects | classInt | scales | htmlwidgets</p>
<hr>
</section>
<section id="expertise" class="level2">
<h2 class="anchored" data-anchor-id="expertise">Expertise</h2>
<p><strong>Domain Expertise:</strong> R&amp;D policy | demographic forecasting | time series analysis | World Bank data | V-Dem data | regression modeling | interactive data visualization</p>
<p><strong>Transferable Expertise:</strong> Translating demographic trend data into actionable forecasts for strategic investment decisions – building regression models that reveal where structural shifts are underway before they are visible in aggregate statistics.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>